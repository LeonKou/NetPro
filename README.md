<p align="center">
  <img  src="docs/images/netpro2.png">
</p>

# NetPro [Pages](https://leonkou.github.io/NetPro/)
![.NET Core](https://github.com/LeonKou/NetPro/workflows/.NET%20Core/badge.svg) 



### ğŸ•°ï¸ æ´»è·ƒåˆ†æ”¯

* ğŸ‘‰[*dev_6.0* branch](https://github.com/LeonKou/NetPro/tree/dev_6.0)

## ç®€è¦

.NetpProæ˜¯ä¸€ç»„ç‹¬ç«‹ä¸­é—´ä»¶çš„ç±»åº“ç»Ÿç§°ï¼Œå…·æœ‰è½»é‡çº§ï¼Œä¾èµ–å°ï¼Œæ˜“ç”¨ä½¿ç”¨ä¸”é«˜æ•ˆã€‚

åœ¨ä»¥å¾€çš„å¼€å‘ä¸­æˆ‘ä»¬å¸¸å¸¸å°è£…å†…ç½®ä¸€å †ç»„ä»¶ä½œä¸ºæ¡†æ¶è¿›è¡Œä½¿ç”¨ï¼Œé¡¹ç›®æ˜¯å¦ä½¿ç”¨è¿™äº›ç»„ä»¶åŠŸèƒ½éƒ½å°†ç»Ÿç»ŸåŠ è½½ï¼Œç»„ä»¶æ— æ³•æ’æ‹”ï¼Œå¾€å¾€éƒ½æ˜¯é›†æˆåº¦å’Œä¾èµ–è¾ƒé«˜ï¼Œå¯¼è‡´æ–°çš„å­¦ä¹ æˆæœ¬ï¼Œå¯¹äºé•¿æœŸç»´æŠ¤åŸ‹ä¸‹äº†å¾ˆå¤§éšæ‚£ï¼›è€Œä¸åšå°è£…åˆè¦é¢å¯¹æ‚ä¹±çš„æ³¨å…¥é¡ºåºå’Œç¹çé‡å¤çš„çš„åˆå§‹åŒ–é€»è¾‘ï¼Œæœ‰æ²¡æœ‰åŠæ³•æ—¢å¯ä»¥æŒ‰éœ€å¼•ç”¨åˆå¯ä»¥é¿å…è¿™äº›åˆå§‹åŒ–é€»è¾‘å¹¶ä¸”éƒ½èƒ½ä»¥å„ç»„ä»¶åŸç”Ÿçš„æ–¹å¼è°ƒç”¨ï¼Œ
NetProå°±æ˜¯ä¸ºè§£å†³ä»¥ä¸Šé—®é¢˜è€Œåˆ›å»ºã€‚


æ‰€æœ‰ç»„ä»¶åœ¨[/src/Library](https://github.com/LeonKou/NetPro/tree/dev_6.0/src/Library)è·¯å¾„ä¸‹ï¼Œæ¯ä¸ªç»„ä»¶å·²æœ‰è¯¦å°½çš„ä½¿ç”¨è¯´æ˜æ–‡æ¡£README.md

ç»„ä»¶å¯åœ¨ä»»æ„é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œä¸å¼ºä¾èµ–NetProç¯å¢ƒï¼Œæ”¯æŒæŒ‰éœ€å¼•ç”¨ï¼Œå¼•ç”¨å³è‡ªåŠ¨åˆå§‹åŒ–ï¼Œå…å»å„ç±»ä¸­é—´ä»¶ç¹çåˆå§‹åŒ–æ“ä½œï¼Œæ”¯æŒ`net3.1` `net6.0`ã€‚NetProé¡¹ç›®åœ¨åŸºäºæ ¸å¿ƒåŒ…`NetPro.Startup`åŸºç¡€ä¸Šæä¾›äº†å…¶ä»–å‘¨è¾¹å¸¸ç”¨ä¸­é—´ä»¶ï¼Œå…¶æ ¸å¿ƒå°è£…é€»è¾‘ä¹Ÿæ˜¯å°½å¯èƒ½çš„æš´éœ²åŸç”Ÿæ–¹æ³•ï¼Œä¸å¯¹å¼€å‘äººå‘˜äº§ç”Ÿè¿‡å¤šä¸å¿…è¦çš„å­¦ä¹ æˆæœ¬ã€‚
åŸºäº`NetPro.Startup`çš„æœ‰ä¸¤ä¸ªå…³é”®æ’ä»¶åŒ…ï¼š
- `NetPro.Web.Api` ç”¨äºå¼€å‘webapié¡¹ç›®
- `NetPro.Grpc` ç”¨äºå¼€å‘grpcé¡¹ç›®

å…¶ä»–çš„æ‰€æœ‰[NetPro](https://github.com/LeonKou/NetPro/tree/dev_6.0/src/Library)ä¸­é—´ä»¶éƒ½æ˜¯å¯æ’æ‹”ï¼ŒæŒ‰éœ€å¼•ç”¨ï¼Œæ¯ä¸ªç»„ä»¶éƒ½ç›¸å¯¹è½»é‡ï¼Œæ²¡æœ‰å¼ºå…³è”NetProï¼Œå³ä½¿é.NetProæ¡†æ¶ä¹Ÿå¯ä½¿ç”¨ã€‚å¦‚æœåŸºäº`NetPro.Web.Api`æˆ– `NetPro.Grpc`å¼•ç”¨çš„NetProä¸­é—´ä»¶ï¼Œæ”¯æŒå¼•ç”¨å³`è‡ªåŠ¨æ‰§è¡Œ`åˆå§‹åŒ–é€»è¾‘ã€‚


### æ¶æ„å›¾

<p align="center">
  <img  src="docs/images/netproinfo.png">
</p>


#### æä¾›çš„ä¸­é—´ä»¶åŒ…å«ä¸é™äºä»¥ä¸‹ï¼š

`FreeSql`,`Autofac` , `Automapper`,`apollo`,`App.Metrics`,

`CsRedisCore`,`StackExchange.Redis`,`Serilog`,

`MiniProfiler`,`FluentValidation`,`IdGen`,

`MongoDb`,`Dapper`,`RedLock.Net`,

`Sentry`,`RabbitMQ.Client`,`SkyAPM`,

`Swagger`,`WebApiClient.Core`,

`TimeZoneConverter`,`healthcheck`

`exceptionless`


### ä½¿ç”¨
##### å„ç»„ä»¶å·²å‘å¸ƒNugetåŒ…ï¼Œå¯å•ç‹¬ä½¿ç”¨ï¼Œå¦‚éœ€æ’ä»¶åŒ–å’Œè‡ªåŠ¨æ‰§è¡Œåˆå§‹åŒ–è¯·ä½¿ç”¨`NetPro.Web.Api`æˆ–è€…`NetPro.Grpc`

##### æ”¯æŒçš„ç»„ä»¶

- [![NuGet](https://img.shields.io/nuget/v/NetPro.Web.Api.svg)](https://nuget.org/packages/NetPro.Web.Api) [NetPro.Web.Api](https://github.com/LeonKou/NetPro.Web.Api) ï¼ˆNetPro.Web.Apiï¼‰

- [![NuGet](https://img.shields.io/nuget/v/NetPro.MQTTClient.svg)](https://nuget.org/packages/NetPro.MQTTClient) [NetPro.MQTTClient](https://github.com/LeonKou/NetPro.MQTTClient) ï¼ˆç‰©è”ç½‘MQTTClientå®¢æˆ·ç«¯ï¼‰

- [![NuGet](https://img.shields.io/nuget/v/NetPro.Globalization.svg)](https://nuget.org/packages/NetPro.Globalization) [NetPro.Globalization](https://github.com/LeonKou/NetPro.Globalization) ï¼ˆå¤šè¯­è¨€å…¨çƒåŒ–ï¼‰

- [![NuGet](https://img.shields.io/nuget/v/NetPro.Cors.svg)](https://nuget.org/packages/NetPro.Cors) [NetPro.Cors](https://github.com/LeonKou/NetPro.Cors) ï¼ˆNetPro.Cors è·¨åŸŸé…ç½®ï¼‰

- [![NuGet](https://img.shields.io/nuget/v/NetPro.ConsulClient.svg)](https://nuget.org/packages/NetPro.ConsulClient) [NetPro.ConsulClient](https://github.com/LeonKou/NetPro.ConsulClient) ï¼ˆNetPro.ConsulClient æœåŠ¡æ³¨å†Œå‘ç°ç»„ä»¶ï¼Œåªéœ€å¼•ç”¨å³å¯æ— éœ€é¢å¤–æ“ä½œï¼‰


- [![NuGet](https://img.shields.io/nuget/v/NetPro.TypeFinder.svg)](https://nuget.org/packages/NetPro.TypeFinder) [NetPro.TypeFinder](https://github.com/LeonKou/NetPro.TypeFinder) ï¼ˆdllæ£€ç´¢ï¼Œåå°„ï¼‰

- [![NuGet](https://img.shields.io/nuget/v/NetPro.Utility.svg)](https://nuget.org/packages/NetPro.Utility) [NetPro.Utility](https://github.com/LeonKou/NetPro.Utility) ï¼ˆåŒ…å«å¸¸ç”¨å¸®åŠ©ç±»ï¼‰

- [![NuGet](https://img.shields.io/nuget/v/NetPro.Authentication.svg)](https://nuget.org/packages/NetPro.Authentication) [NetPro.Authentication](https://github.com/LeonKou/NetPro.Authentication) ï¼ˆè®¤è¯ç›¸å…³ï¼‰

- [![NuGet](https://img.shields.io/nuget/v/NetPro.EasyNetQ.svg)](https://nuget.org/packages/NetPro.EasyNetQ) [NetPro.EasyNetQ](https://github.com/LeonKou/NetPro.EasyNetQ) ï¼ˆEasyNetQï¼Œæ”¯æŒå¤šserverï¼‰

- [![NuGet](https://img.shields.io/nuget/v/NetPro.Checker.svg)](https://nuget.org/packages/NetPro.Checker) [NetPro.Checker](https://github.com/LeonKou/NetPro.Checker) ï¼ˆç»„ä»¶å¥åº·æ£€æŸ¥ï¼‰

- [![NuGet](https://img.shields.io/nuget/v/NetPro.MongoDb.svg)](https://nuget.org/packages/NetPro.MongoDb ) [NetPro.MongoDb ](https://github.com/LeonKou/NetPro.MongoDb ) ï¼ˆmongodbiï¼‰

- [![NuGet](https://img.shields.io/nuget/v/NetPro.CsRedis.svg)](https://nuget.org/packages/NetPro.CsRedis) [NetPro.CsRedis](https://github.com/LeonKou/NetPro.CsRedis) ï¼ˆredisæ¨èä½¿ç”¨æ­¤ç»„ä»¶ï¼›CsRedisåˆ†å¸ƒå¼é”ï¼‰

- [![NuGet](https://img.shields.io/nuget/v/NetPro.RedisManager.svg)](https://nuget.org/packages/NetPro.RedisManager ) [NetPro.RedisManager ](https://github.com/LeonKou/NetPro.RedisManager ) ï¼ˆRedisç»„ä»¶ï¼ŒåŒ…å«CsRedisï¼ŒStackExchangeRedisï¼Œåˆ†å¸ƒå¼é”ï¼‰

- [![NuGet](https://img.shields.io/nuget/v/NetPro.Swagger.svg)](https://nuget.org/packages/NetPro.Swagger ) [NetPro.Swagger ](https://github.com/LeonKou/NetPro.Swagger ) ï¼ˆSwaggerï¼ŒåŒ…å«è®¤è¯ï¼Œæ–‡ä»¶ä¸Šä¼ ï¼Œå…¬å…±å‚ï¼Œä¸ªæ€§ä¸»é¢˜ï¼‰

- [![NuGet](https://img.shields.io/nuget/v/NetPro.Sign.svg)](https://nuget.org/packages/NetPro.Sign ) [NetPro.Sign ](https://github.com/LeonKou/NetPro.Sign ) ï¼ˆç­¾åï¼‰

- [![NuGet](https://img.shields.io/nuget/v/NetPro.ResponseCache.svg)](https://nuget.org/packages/NetPro.ResponseCache ) [NetPro.ResponseCache ](https://github.com/LeonKou/NetPro.ResponseCache ) ï¼ˆå“åº”ç¼“å­˜ï¼‰

- [![NuGet](https://img.shields.io/nuget/v/NetPro.AutoMapper.svg)](https://nuget.org/packages/NetPro.AutoMapper ) [NetPro.AutoMapper ](https://github.com/LeonKou/NetPro.AutoMapper ) ï¼ˆå¯¹è±¡æ˜ å°„ï¼‰

- [![NuGet](https://img.shields.io/nuget/v/NetPro.Analysic.svg)](https://nuget.org/packages/NetPro.Analysic) [NetPro.Analysic](https://github.com/LeonKou/NetPro.Analysic)(è¯·æ±‚åˆ†ææ§åˆ¶ï¼Œå¯ç²¾ç»†é…ç½®åŒipä¸€å®šæ—¶é—´çš„é”™è¯¯æ•°å’Œæ­£ç¡®æ•°ï¼Œè¶…è¿‡é˜ˆå€¼æ‹¦æˆªç†”æ–­è®¿é—®)

---

å…·ä½“å‚è€ƒ NetPro\src\Template\API\Contentï¼ˆæ’æ¨¡å—æ’ä»¶)é¡¹ç›®

 webapié¡¹ç›®å¼•ç”¨ `NetPro.Web.Api` [![NuGet](https://img.shields.io/nuget/v/NetPro.Web.Api.svg)](https://nuget.org/packages/NetPro.Web.Api)  å¼•ç”¨æœ€æ–°nugetå³å¯

Package Manageræ–¹å¼: `Install-Package NetPro.Web.Api -Version 3.1.2`

.NET CLI æ–¹å¼: `dotnet add package NetPro.Web.Api --version 3.1.2`

PackageReference:`<PackageReference Include="NetPro.Web.Api" Version="3.1.2" />`

.NET CLI æ–¹å¼: `paket add NetPro.Web.Api --version 3.1.2`

---

## é€šè¿‡è„šæ‰‹æ¶åˆ›å»ºé¡¹ç›®(æ¨è)

### 1ã€å®‰è£…netproapi[![NuGet](https://img.shields.io/nuget/v/netproapi.svg)](https://nuget.org/packages/netproapi)è„šæ‰‹æ¶
æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…è„šæ‰‹æ¶
```
dotnet new -i netproapi::* 
```

### 2ã€ä½¿ç”¨è„šæ‰‹æ¶åˆ›å»ºé¡¹ç›®

åœ¨æŒ‡å®šçš„é¡¹ç›®æ–‡ä»¶å¤¹ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤
```
dotnet new netproapi -n é¡¹ç›®åç§°
```
ä¾‹å¦‚å½“å‰é¡¹ç›®ä¸ºIAM
```
dotnet new netproapi -n IAM
```
æ‰§è¡Œä»¥ä¸Šå‘½ä»¤å°†è‡ªåŠ¨åˆ›å»ºWebApiä»£ç è§£å†³æ–¹æ¡ˆ

## æ‰‹åŠ¨åˆ›å»ºé¡¹ç›®

*  ä¿®æ”¹`Program.cs`

```csharp

Environment.SetEnvironmentVariable("ASPNETCORE_HOSTINGSTARTUPASSEMBLIES", "NetPro.Startup");

var host = Host.CreateDefaultBuilder(args)
                .ConfigureAppConfiguration((hostingContext, config) =>
                {
                    ApolloClientHelper.ApolloConfig(hostingContext, config, args);
                });

host.Build().Run();

```

* å¢åŠ  `EndpointsStartup.cs`æ–‡ä»¶é…ç½®
å¯åŠ å¤šä¸ªç»§æ‰¿äº†INetProStartupæ¥å£çš„å¯åŠ¨ç±»æ¥æ§åˆ¶å¯åŠ¨é¡ºåºå’Œåˆå§‹åŒ–
æ­¤æ–‡ä»¶ç»§æ‰¿`INetProStartup`æ¥å£ï¼Œæä¾›äº†microsoftåŸç”Ÿä¾èµ–æ³¨å…¥èƒ½åŠ›ï¼Œæ‰€æœ‰ç»„ä»¶æ³¨å…¥æ”¾äºæ­¤ ï¼ŒStartup.cså°†ä¸æ¥å—ç»„ä»¶æ³¨å…¥

```csharp
// <auto-generated>
//  UseEndpoints   
// </auto-generated>

using Microsoft.AspNetCore.Builder;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;

namespace NetPro.Web.Api
{
    /// <summary>
    /// Endpoints 
    /// </summary>
    public class EndpointsStartup : INetProStartup
    {
        /// <summary>
        /// 
        /// </summary>
        /// <param name="services"></param>
        /// <param name="configuration"></param>
        /// <param name="typeFinder"></param>
        public void ConfigureServices(IServiceCollection services, IConfiguration configuration, ITypeFinder typeFinder)
        {

        }

        /// <summary>
        /// Endpointsè¯·æ±‚ç®¡é“;
        /// Orderæ‰§è¡Œé¡ºåºä¿è¯åœ¨RoutingStartupï¼ˆ200ï¼‰ä¹‹åå³å¯
        /// </summary>
        /// <param name="application"></param>
        /// <param name="env"></param>
        public void Configure(IApplicationBuilder application, IWebHostEnvironment env)
        {
            application.UseEndpoints(s =>
            {
                //å¯¹äºè¯·æ±‚çš„é…ç½®éƒ½å¯åœ¨æ­¤å¤„
                s.MapControllers()
                //.RequireAuthorization() //å…¨å±€æ·»åŠ è®¤è¯æˆæƒ
                ;
            });
        }

        /// <summary>
        /// UseEndpoints can be executed after RoutingStartup
        /// </summary>
        public double Order { get; set; } = 1000;
    }
}

```

* ä¿®æ”¹`appsettings.json` æ–‡ä»¶

```json
{
	"TypeFinderOption": {
		"MountePath": ""//æ’ä»¶æŒ‚è½½è·¯å¾„ï¼Œå¯é»˜è®¤
	}
}


```

* Controllerä½¿ç”¨

`Controller`ç»§æ‰¿åŸç”Ÿ`ControllerBase`å³å¯ï¼Œä½¿ç”¨ä¹Ÿå‚è€ƒå®˜æ–¹åŸç”Ÿæ¥å£å¼€å‘

```csharp

	/// <summary>
	///
	/// </summary>
	[Route("api/v1/[controller]")]
	public class WeatherForecastController : ControllerBase
	{
		private readonly ILogger _logger;
		private IExampleProxy _userApi { get; set; }

		public WeatherForecastController(ILogger logger
			 ,IExampleProxy userApi)
		{
			_logger = logger;
			_userApi = userApi;
		}
	}
```
#### çº¦å®š


* `Service` ä¸šåŠ¡ç›¸å…³
* `Repository` æ•°æ®ä»“å‚¨ç›¸å…³(éœ€è¦ç›´æ¥åœ¨Serviceæˆ–Controllerä¸­ç›´æ¥æ“ä½œæ•°æ®åº“å¯æ— éœ€ä½¿ç”¨æ­¤åç¼€)
* `Proxy` ä»£ç†è¯·æ±‚ç›¸å…³ï¼ˆè¯·æ±‚è¿œç¨‹æ¥å£ä½¿ç”¨ï¼‰
* `Aggregate` èšåˆç›¸å…³ï¼Œå½“Service æˆ–è€…Controller ä¸šåŠ¡é€»è¾‘ç¹çå¤æ‚å¯åœ¨æ­¤èšåˆåå†è°ƒç”¨

### å‘å¸ƒ

###### å‘å¸ƒè‡ªåŒ…å«åº”ç”¨

```
dotnet publish -r linux-x64 -c release /p:PublishSingleFile=true /p:PublishTrimmed=true
```
###### ä¾èµ–CLRè¿è¡Œæ—¶åº”ç”¨
```
dotnet publish -r linux-x64 -c release
```

### è¿è¡Œ

å¼€å‘ç¯å¢ƒè¿è¡Œåæ•ˆæœå¦‚ä¸‹ï¼š

```
 ____  _____        _   _______
|_   \|_   _|      / |_|_   __ \
  |   \ | |  .---.`| |-' | |__) |_ .--.   .--.
  | |\ \| | / /__\\| |   |  ___/[ `/'`\]/ .'`\ \
 _| |_\   |_| \__.,| |, _| |_    | |    | \__. |
|_____|\____|'.__.'\__/|_____|  [___]    '.__.'


[17:40:03] dotnet process id:14520
The enhanced service has started
[17:40:04] loading json files
Service injection sequenceï¼š
[17:40:15] apolloå·²å…³é—­
info: NetProSwaggerServiceExtensions[0]
      NetPro Swagger å·²å¯ç”¨
--------------------------------------------------------------------------------------------------------------------------------------
|    Order   |       StartupClassName       |                   Path                   |             Assembly            |  Version  |
--------------------------------------------------------------------------------------------------------------------------------------
| 0          | NetProCoreStartup            | NetPro.Core.Startup.NetProCoreStartup    | NetPro.Core                     |  3.1.13.0 |
--------------------------------------------------------------------------------------------------------------------------------------
| 0          | CheckerStartup               | NetPro.Analysic.CheckerStartup           | NetPro.Checker                  |  3.1.13.0 |
--------------------------------------------------------------------------------------------------------------------------------------
| 0          | ErrorHandlerStartup(default) | NetPro.Web.Api.ErrorHandlerStartup       | NetPro.Web.Api                  |  3.1.13.0 |
--------------------------------------------------------------------------------------------------------------------------------------
| 100        | SwaggerStartup               | NetPro.Swagger.SwaggerStartup            | NetPro.Swagger                  |  3.1.13.0 |
--------------------------------------------------------------------------------------------------------------------------------------
| 100        | StaticFilesStartup(default)  | NetPro.Web.Api.StaticFilesStartup        | NetPro.Web.Api                  |  3.1.13.0 |
--------------------------------------------------------------------------------------------------------------------------------------
| 200        | RoutingStartup(default)      | NetPro.Web.Api.RoutingStartup            | NetPro.Web.Api                  |  3.1.13.0 |
--------------------------------------------------------------------------------------------------------------------------------------
| 300        | CorsStartup                  | NetPro.Web.Api.CorsStartup               | NetPro.Web.Api                  |  3.1.13.0 |
--------------------------------------------------------------------------------------------------------------------------------------
| 400        | ShareBodyStartup             | NetPro.ShareRequestBody.ShareBodyStartup | NetPro.NetProShareRequestBody   |  3.1.13.0 |
--------------------------------------------------------------------------------------------------------------------------------------
| 1000       | EndpointsStartup(default)    | NetPro.Web.Api.EndpointsStartup          | XXX.API (custom)                |  1.0.0.0  |
--------------------------------------------------------------------------------------------------------------------------------------
| 1000       | NetProCsRedisStartup         | NetPro.CsRedis.NetProCsRedisStartup      | NetPro.CsRedis                  |  3.1.13.0 |
--------------------------------------------------------------------------------------------------------------------------------------
| 2147483647 | ApiStartup                   | XXX.API.ApiStartup                       | XXX.API (custom)                |  1.0.0.0  |
--------------------------------------------------------------------------------------------------------------------------------------
| 2147483647 | ApiStartup-1                 | XXX.Plugin.Web.Demo.ApiStartup           | XXX.Plugin.Web.Demo (custom)    |  1.0.0.0  |
--------------------------------------------------------------------------------------------------------------------------------------
| 2147483647 | ApiStartup-2                 | XXX.Plugin.Web.Manager.ApiStartup        | XXX.Plugin.Web.Manager (custom) |  1.0.0.0  |

```
ç¬¬ä¸€æ¬¡åˆå§‹åŒ–ä¼šè‡ªåŠ¨åœ¨ç¨‹åºå½“å‰ç›®å½•ç”Ÿæˆ`StartupConfig/startup.json`æ–‡ä»¶å¯ä¿®æ”¹å¯¹åº”Orderæ¥è¦†ç›–å„ä¸­é—´ä»¶é»˜è®¤æ‰§è¡Œé¡ºåº
```json
{
  "NetProCoreStartup": 0,
  "CheckerStartup": 0,
  "ErrorHandlerStartup": 0,
  "SwaggerStartup": 100,
  "StaticFilesStartup": 100,
  "RoutingStartup": 200,
  "CorsStartup": 300,
  "ShareBodyStartup": 400,
  "EndpointsStartup": 1000,
  "ApiStartup": 2147483647,
  "ApiStartup-1": 2147483647,
  "ApiStartup-2": 2147483647
}

```

### IConfiguration é…ç½®

åœ¨asp.netcoreé»˜è®¤çš„appsettings.jsoné…ç½®ç­–ç•¥ä¸Šå¢åŠ äº†è‡ªå®šä¹‰ç›®å½•é…ç½®ï¼Œä¾‹å¦‚åœ¨appsettings.jsonä¸­å¢åŠ ConfigPathé…ç½®æ–‡ä»¶ç›®å½•
```
 "ConfigPath": "configjson",//é…ç½®ç›®å½•
```
å³å¯åœ¨configjsonç›®å½•ä¸‹åˆ›å»ºjsonæ–‡ä»¶ä¼šè‡ªåŠ¨åŠ å…¥é…ç½®é©±åŠ¨ä¸­ï¼Œå¹¶æ”¯æŒç¯å¢ƒåŠ è½½ï¼Œä¾‹å¦‚æœ‰ä»¥ä¸‹ä¸¤ä»½jsoné…ç½®æ–‡ä»¶
- checker.json
- checker.Development.json

åœ¨è‡ªåŠ¨åŠ è½½checker.jsoné…ç½®æ–‡ä»¶çš„åŒæ—¶ï¼Œä¾æ®å½“å‰ç¯å¢ƒå†³å®šæ˜¯å¦åŠ è½½checker.Development.jsonï¼Œå¦‚å½“å‰ç¯å¢ƒä¸ºDevelopment ï¼Œå³è‡ªåŠ¨åŠ è½½checker.Development.jsonæ–‡ä»¶ä»¥è¦†ç›–checker.jsonçš„ç›¸åŒèŠ‚ç‚¹é…ç½®ä¿¡æ¯


### æ’ä»¶æ–¹å¼å¼€å‘

å¯å°†å¼€å‘å¥½çš„dllä¸¢å…¥TypeFinderOption:MountePath é…ç½®çš„æ–‡ä»¶è·¯å¾„ä¸­ï¼Œå³å¯è‡ªåŠ¨åŠ è½½å½“å‰dllæ— éœ€å·¥ç¨‹æ–‡ä»¶å¼•ç”¨

Swaggeråœ°å€ï¼š[/swagger/index.html](ip:port/docs/index.html)
<p align="center">
  <img  src="docs/images/swagger.jpg">
</p>

å¥åº·æ£€æŸ¥åœ°å€ [/health](health)

å¥åº·æ£€æŸ¥é¢æ¿[/ui](healthdashboard)
<p align="center">
  <img  src="docs/images/checkhealth.jpg">
</p>

åº”ç”¨ä¿¡æ¯ [/info](/info)

ç¯å¢ƒä¿¡æ¯ [/env](/env)

## é—®é¢˜å¤„ç†æŒ‡å—

### 1. å¦‚ä½•è¦†ç›–ç³»ç»Ÿå¼‚å¸¸å¤„ç†

```csharp
var mvcBuilder = services.AddControllers(config =>
   {
    config.Filters.Add(typeof(CustomerExceptionFilter),2);//è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸è¿‡æ»¤å™¨//100æ˜¯orderå€¼ï¼Œè¶Šå¤§è¶Šé ååŠ è½½
});
```
 ...

 ## æ€§èƒ½æŒ‡æ ‡

![](docs/images/performance.png)
åœ¨6æ ¸16Gå†…å­˜15ç§’å†…æ‰§è¡Œmaridbæ•°æ®åº“æ’å…¥ï¼Œqpså¯è¾¾åˆ°25304ï¼Œå¹¶ä¸”å¯æ ¹æ®åœºæ™¯è°ƒæ•´å†…å­˜å’Œæ€§èƒ½æ–¹é¢çš„å¹³è¡¡ï¼Œè¿™å°±æ˜¯ä¾èµ–æœ€å°åŒ–å¸¦æ¥çš„å¥½å¤„ï¼Œç®€å•é«˜æ•ˆï¼Œä¾èµ–è¶Šå°é—®é¢˜è¶Šæ¸…æ™°ã€‚
## é«˜çº§é…ç½® 

### CLRé…ç½®
[Runtime configuration options for garbage collection](https://docs.microsoft.com/zh-cn/dotnet/core/runtime-config/garbage-collector)
é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶è¿è¡ŒçŠ¶æ€
runtimeconfig.template.json
```json
{
   {
      "configProperties": {
       "System.GC.Server": true,//ç«™ç‚¹ä¸“ç”¨é…ç½®,é»˜è®¤false
       "System.GC.HeapHardLimit": 83886080,å †ä¸Šé™ï¼Œå•ä½å­—èŠ‚
       "System.GC.HeapHardLimitPercent": 5,//å †ä¸Šé™ï¼Œå•ä½ç™¾åˆ†æ¯”ï¼Œå»ºè®®ä¸HeapHardLimitäºŒé€‰ä¸€
       "System.GC.LOHThreshold": 1048576,//å¤§å¯¹è±¡å®šä¹‰ï¼Œå•ä½å­—èŠ‚
       "System.GC.Concurrent": true,//åå°å›æ”¶ï¼Œé»˜è®¤true
       "System.Runtime.Serialization.EnableUnsafeBinaryFormatterSerialization": false,
       "System.Threading.ThreadPool.MinThreads": 200
      }
    }
  }
}
```

### CLRç›‘æ§
[CLR å…¨å±€å·¥å…·](https://docs.microsoft.com/zh-cn/dotnet/core/diagnostics/dotnet-counters)
å¸¸ç”¨clrå‘½ä»¤è¡Œå·¥å…·

- dotnet-counters [Performance monitoring](https://www.stefangeiger.ch/2020/05/07/dotnet-diagnostics-tools-counters.html)
- dotnet-monitor [configuration](dotnet-monitor)
- dotnet-gcdump
- dotnet-trace

dotnet-monitor è‡ªå¸¦apiæœåŠ¡ï¼Œæ–¹ä¾¿restful è°ƒç”¨ï¼Œæ¨èä½¿ç”¨æ­¤å·¥å…·
å®‰è£…:
dotnet tool install -g dotnet-monitor
é…ç½®: [dotnet-monitor configuration](https://github.com/dotnet/dotnet-monitor/blob/main/documentation/configuration.md)

ä½¿ç”¨ `dotnet monitor config show` æ‰“å°é…ç½®

è¦†ç›–é…ç½®ï¼š
windowsï¼š`C:\Users\username\.dotnet-monitor\settings.json`

```
{
    "Metrics": {
      "Endpoints": "http://localhost:5009",
      "MetricCount": 3      
    }
  }
```
å¯åŠ¨:
dotnet monitor collect

æ³¨æ„ï¼š

é€šå¸¸dotnet monitoråœ¨å®¹å™¨ä¸­ä½¿ç”¨æ—¶åˆ©ç”¨è¾¹è½¦æ¨¡å¼è¿è¡Œï¼Œæ•…éœ€è¦é…ç½®å…±äº«volumeï¼Œå³é€šè¿‡IPCå®ç°å®¹å™¨é—´å…±äº«å†…å­˜é€šä¿¡æ¥æ”¶é›†ç›®æ ‡è¿›ç¨‹ä¸­è¯Šæ–­æ•°æ®
[.NET 6's dotnet monitor](https://www.cnblogs.com/stulzq/archive/2021/12/06/15650277.html)

[github:dotnet-monitor-ui](https://github.com/SachiraChin/dotnet-monitor-ui)

[dotnet-monitor-ui](https://dotnet-monitor-ui.dev/)

## Target

- å¯è§†åŒ–å®‰è£…å¸è½½ç»„ä»¶

# ...

